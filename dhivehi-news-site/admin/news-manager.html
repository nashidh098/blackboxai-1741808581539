<!DOCTYPE html>
<html lang="dv" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ޚަބަރު މެނޭޖްކުރުން - ދިވެހި ނިއުސް</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="../assets/images/favicon.svg">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thaana:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/css/style.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'body': ['Noto Sans Thaana', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>
<body class="font-body bg-gray-50">
    <!-- Admin Header -->
    <header class="bg-white shadow">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex justify-between items-center">
                <h1 class="text-2xl font-bold text-gray-900">ޚަބަރު މެނޭޖްކުރުން</h1>
                <div class="flex items-center space-x-4">
                    <a href="dashboard.html" class="text-gray-600 hover:text-gray-900">
                        <i class="fas fa-tachometer-alt ml-2"></i>
                        ޑޭޝްބޯޑް
                    </a>
                    <button class="logout-btn text-red-600 hover:text-red-800">
                        <i class="fas fa-sign-out-alt ml-2"></i>
                        ލޮގްއައުޓް
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <!-- Add News Form -->
        <div class="bg-white shadow rounded-lg p-6">
            <h2 class="text-xl font-bold mb-6">އާ ޚަބަރެއް އިތުރުކުރުން</h2>
            <form id="addNewsForm" class="space-y-6">
                <!-- News Title -->
                <div>
                    <label for="newsTitle" class="block text-sm font-medium text-gray-700 mb-2">ސުރުޚީ</label>
                    <input type="text" id="newsTitle" name="newsTitle" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>

                <!-- News Category -->
                <div>
                    <label for="newsCategory" class="block text-sm font-medium text-gray-700 mb-2">ކެޓަގަރީ</label>
                    <select id="newsCategory" name="newsCategory" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        <option value="general">އާންމު</option>
                        <option value="politics">ސިޔާސީ</option>
                        <option value="sports">ކުޅިވަރު</option>
                        <option value="business">ވިޔަފާރި</option>
                        <option value="entertainment">މުނިފޫހިފިލުވުން</option>
                    </select>
                </div>

                <!-- Featured Image -->
                <div>
                    <label for="newsImage" class="block text-sm font-medium text-gray-700 mb-2">މައި ފޮޓޯ</label>
                    <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                        <div class="space-y-1 text-center">
                            <div class="flex text-sm text-gray-600">
                                <label for="newsImage" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500">
                                    <span>ފޮޓޯއެއް އަޕްލޯޑްކުރުމަށް ފިތާލާ</span>
                                    <input id="newsImage" name="newsImage" type="file" class="sr-only" accept="image/*" required>
                                </label>
                            </div>
                            <p class="text-xs text-gray-500">PNG, JPG, GIF up to 5MB</p>
                        </div>
                    </div>
                    <div id="imagePreview" class="mt-4 hidden">
                        <img id="previewImg" src="" alt="Preview" class="max-h-48 rounded">
                    </div>
                </div>

                <!-- News Content -->
                <div>
                    <label for="newsContent" class="block text-sm font-medium text-gray-700 mb-2">ޚަބަރުގެ ތަފްސީލް</label>
                    <textarea id="newsContent" name="newsContent" rows="10" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea>
                </div>

                <!-- Breaking News Toggle -->
                <div class="flex items-center">
                    <input type="checkbox" id="isBreaking" name="isBreaking" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                    <label for="isBreaking" class="mr-2 block text-sm text-gray-900">އާ ޚަބަރެއްގެ ގޮތުގައި ދެއްކުން</label>
                </div>

                <!-- Submit Button -->
                <div class="flex justify-end">
                    <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        ޚަބަރު ޝާއިޢުކުރުން
                    </button>
                </div>
            </form>
        </div>

        <!-- Recent News List -->
        <div class="mt-8 bg-white shadow rounded-lg p-6">
            <h2 class="text-xl font-bold mb-6">އެންމެ ފަހުގެ ޚަބަރުތައް</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">ސުރުޚީ</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">ކެޓަގަރީ</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">ތާރީޚް</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">އެކްޝަން</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="recentNewsList">
                        <!-- News items will be dynamically added here -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Auth Script -->
    <script src="../assets/js/auth.js"></script>

    <!-- News Manager Script -->
    <script>
        // Image preview functionality
        document.getElementById('newsImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('imagePreview').classList.remove('hidden');
                }
                reader.readAsDataURL(file);
            }
        });

        // Form submission
        document.getElementById('addNewsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form data
            const formData = {
                title: document.getElementById('newsTitle').value,
                category: document.getElementById('newsCategory').value,
                content: document.getElementById('newsContent').value,
                isBreaking: document.getElementById('isBreaking').checked,
                date: new Date().toISOString(),
                image: document.getElementById('previewImg').src
            };

            // Get existing news from localStorage or initialize empty array
            let news = JSON.parse(localStorage.getItem('news') || '[]');
            
            // Add new news to array
            news.unshift(formData);
            
            // Save back to localStorage
            localStorage.setItem('news', JSON.stringify(news));

            // Reset form
            e.target.reset();
            document.getElementById('imagePreview').classList.add('hidden');

            // Refresh news list
            displayRecentNews();

            // Show success message
            alert('ޚަބަރު ކާމިޔާބުކަމާއެކު ޝާއިޢުކުރެވިއްޖެ');
        });

        // Display recent news
        function displayRecentNews() {
            const news = JSON.parse(localStorage.getItem('news') || '[]');
            const tbody = document.getElementById('recentNewsList');
            tbody.innerHTML = news.map((item, index) => `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.title}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.category}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(item.date).toLocaleDateString('dv-MV')}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="editNews(${index})" class="text-blue-600 hover:text-blue-900 ml-3">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteNews(${index})" class="text-red-600 hover:text-red-900">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Edit news
        function editNews(index) {
            const news = JSON.parse(localStorage.getItem('news') || '[]');
            const item = news[index];
            
            document.getElementById('newsTitle').value = item.title;
            document.getElementById('newsCategory').value = item.category;
            document.getElementById('newsContent').value = item.content;
            document.getElementById('isBreaking').checked = item.isBreaking;
            
            if (item.image) {
                document.getElementById('previewImg').src = item.image;
                document.getElementById('imagePreview').classList.remove('hidden');
            }

            // Remove the item from array
            news.splice(index, 1);
            localStorage.setItem('news', JSON.stringify(news));
            displayRecentNews();
        }

        // Delete news
        function deleteNews(index) {
            if (confirm('މި ޚަބަރު ފޮހެލަން ބޭނުންތޯ؟')) {
                const news = JSON.parse(localStorage.getItem('news') || '[]');
                news.splice(index, 1);
                localStorage.setItem('news', JSON.stringify(news));
                displayRecentNews();
            }
        }

        // Initial load
        displayRecentNews();
    </script>
</body>
</html>
